"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5412],{3287:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});var r=s(2540),o=s(3023);const i={title:"3.0 migration",sidebar_label:"3.0"},d=void 0,t={id:"migrate/3.0",title:"3.0 migration",description:"Shifted supported platform versions",source:"@site/docs/migrate/3.0.md",sourceDirName:"migrate",slug:"/migrate/3.0",permalink:"/docs/migrate/3.0",draft:!1,unlisted:!1,editUrl:"https://github.com/milesj/packemon/edit/master/website/docs/migrate/3.0.md",tags:[],version:"current",frontMatter:{title:"3.0 migration",sidebar_label:"3.0"},sidebar:"docs",previous:{title:"4.0",permalink:"/docs/migrate/4.0"},next:{title:"2.0",permalink:"/docs/migrate/2.0"}},c={},l=[{value:"Shifted supported platform versions",id:"shifted-supported-platform-versions",level:2},{value:"Before",id:"before",level:4},{value:"After",id:"after",level:4},{value:"Dropped ES5 support",id:"dropped-es5-support",level:3},{value:"No longer workspaces aware by default",id:"no-longer-workspaces-aware-by-default",level:2},{value:"Commands must now be ran from the package root",id:"commands-must-now-be-ran-from-the-package-root",level:2},{value:"TypeScript declarations now require explicitly named configs",id:"typescript-declarations-now-require-explicitly-named-configs",level:2},{value:"TypeScript declaration output directory has changed",id:"typescript-declaration-output-directory-has-changed",level:2},{value:"Package <code>exports</code> have changed",id:"package-exports-have-changed",level:2},{value:"Publishable files are now lenient",id:"publishable-files-are-now-lenient",level:2},{value:"Removed sourcemaps from Node.js",id:"removed-sourcemaps-from-nodejs",level:2},{value:"Other minor changes",id:"other-minor-changes",level:2}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"shifted-supported-platform-versions",children:"Shifted supported platform versions"}),"\n",(0,r.jsxs)(n.p,{children:["Since Node.js v14 has reached ",(0,r.jsx)(n.a,{href:"https://nodejs.org/en/about/releases/",children:"end of life"}),", Packemon now\nrequires at minimum v16.12 and above to run. Furthermore, we're entirely dropping v12 support, and\nshifting v14 into ",(0,r.jsx)(n.code,{children:"legacy"}),", v16 into ",(0,r.jsx)(n.code,{children:"stable"}),", v18 into ",(0,r.jsx)(n.code,{children:"current"}),", and the new v19 into\n",(0,r.jsx)(n.code,{children:"experimental"}),". As part of this process, we are also bumping minimum requirements and coupled npm\nversions."]}),"\n",(0,r.jsxs)(n.p,{children:["The updated ",(0,r.jsx)(n.a,{href:"/docs/config#support",children:(0,r.jsx)(n.code,{children:"support"})})," compatibility table is as follows."]}),"\n",(0,r.jsx)(n.h4,{id:"before",children:"Before"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{children:"Legacy"}),(0,r.jsx)(n.th,{children:"Stable"}),(0,r.jsx)(n.th,{children:"Current"}),(0,r.jsx)(n.th,{children:"Experimental"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node"}),(0,r.jsx)(n.td,{children:">= 12.22.0"}),(0,r.jsx)(n.td,{children:">= 14.15.0"}),(0,r.jsx)(n.td,{children:">= 16.12.0"}),(0,r.jsx)(n.td,{children:">= 18.0.0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"npm"}),(0,r.jsx)(n.td,{children:">= 6.14.0"}),(0,r.jsx)(n.td,{children:">= 6.14.0"}),(0,r.jsx)(n.td,{children:">= 8.1.0"}),(0,r.jsx)(n.td,{children:">= 8.5.0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"native"}),(0,r.jsx)(n.td,{children:"iOS 12"}),(0,r.jsx)(n.td,{children:"iOS 13"}),(0,r.jsx)(n.td,{children:"iOS 14"}),(0,r.jsx)(n.td,{children:"iOS 15"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"after",children:"After"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{}),(0,r.jsx)(n.th,{children:"Legacy"}),(0,r.jsx)(n.th,{children:"Stable"}),(0,r.jsx)(n.th,{children:"Current"}),(0,r.jsx)(n.th,{children:"Experimental"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"node"}),(0,r.jsx)(n.td,{children:">= 14.15.0"}),(0,r.jsx)(n.td,{children:">= 16.12.0"}),(0,r.jsx)(n.td,{children:">= 18.12.0"}),(0,r.jsx)(n.td,{children:">= 19.0.0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"npm"}),(0,r.jsx)(n.td,{children:">= 6.14.0"}),(0,r.jsx)(n.td,{children:">= 8.1.0"}),(0,r.jsx)(n.td,{children:">= 8.19.0"}),(0,r.jsx)(n.td,{children:">= 9.0.0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"native"}),(0,r.jsx)(n.td,{children:"iOS 13"}),(0,r.jsx)(n.td,{children:"iOS 14"}),(0,r.jsx)(n.td,{children:"iOS 15"}),(0,r.jsx)(n.td,{children:"iOS 16"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Notable changes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining",children:"Optional chaining"}),",\n",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator",children:"nullish coalescing"}),"\nare no longer transformed for ",(0,r.jsx)(n.em,{children:"all"})," targets."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_nullish_assignment",children:"Logical assignment operators"}),"\nare no longer transformed for ",(0,r.jsx)(n.code,{children:"stable"})," and up targets."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import",children:"Dynamic import"}),"\nis no longer transformed to ",(0,r.jsx)(n.code,{children:"require()"})," for all ",(0,r.jsx)(n.code,{children:"node"})," targets."]}),"\n",(0,r.jsxs)(n.li,{children:["Node built-in imports will now use the ",(0,r.jsx)(n.code,{children:"node:"})," prefix."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dropped-es5-support",children:"Dropped ES5 support"}),"\n",(0,r.jsxs)(n.p,{children:["Furthermore, we have dropped ",(0,r.jsx)(n.code,{children:"es5"})," support from the ",(0,r.jsx)(n.code,{children:"legacy"})," target, and replaced it with ",(0,r.jsx)(n.code,{children:"es2018"}),".\nThe ",(0,r.jsx)(n.code,{children:"stable"})," target has also been updated to ",(0,r.jsx)(n.code,{children:"es2019"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"no-longer-workspaces-aware-by-default",children:"No longer workspaces aware by default"}),"\n",(0,r.jsxs)(n.p,{children:["Packemon was originally designed to work in both polyrepo's and monorepo's. When the ",(0,r.jsx)(n.code,{children:"packemon"}),"\ncommand was ran in a workspace root, it would apply to ",(0,r.jsx)(n.em,{children:"all"})," packages in the workspace. This was\npretty cool and worked great. However, it overcomplicated our implementation and required many poly\nvs mono checks everywhere. It was becoming a nightmare to maintain and ensure correct boundaries."]}),"\n",(0,r.jsxs)(n.p,{children:["To remedy this, we refactored every piece of Packemon from the ground up to break these 2 patterns\napart. The ",(0,r.jsx)(n.code,{children:"packemon build"}),", ",(0,r.jsx)(n.code,{children:"packemon pack"}),", and other commands (below) will only apply to 1\npackage now, the one found in the current working directory."]}),"\n",(0,r.jsxs)(n.p,{children:["For workspaces, we've added new ",(0,r.jsx)(n.code,{children:"packemon build-workspace"})," and ",(0,r.jsx)(n.code,{children:"packemon pack-workspace"})," commands,\nwhich mimic the previous functionality, and should be ran in the workspace root."]}),"\n",(0,r.jsx)(n.h2,{id:"commands-must-now-be-ran-from-the-package-root",children:"Commands must now be ran from the package root"}),"\n",(0,r.jsxs)(n.p,{children:["Because of the above change, all the primary commands -- ",(0,r.jsx)(n.code,{children:"build"}),", ",(0,r.jsx)(n.code,{children:"clean"}),", ",(0,r.jsx)(n.code,{children:"files"}),", ",(0,r.jsx)(n.code,{children:"init"}),", ",(0,r.jsx)(n.code,{children:"pack"}),",\n",(0,r.jsx)(n.code,{children:"validate"}),", ",(0,r.jsx)(n.code,{children:"watch"})," -- must now be ran from the package root, as our tooling assumes the package is\nlocated in the current working directory. They can no longer be ran from the workspace root if using\na monorepo."]}),"\n",(0,r.jsxs)(n.p,{children:["This does not apply to the ",(0,r.jsx)(n.code,{children:"scaffold"})," command (and the new ",(0,r.jsx)(n.code,{children:"build-workspace"})," and ",(0,r.jsx)(n.code,{children:"pack-workspace"}),"\ncommands), as they should always be ran from the repository root."]}),"\n",(0,r.jsx)(n.h2,{id:"typescript-declarations-now-require-explicitly-named-configs",children:"TypeScript declarations now require explicitly named configs"}),"\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.code,{children:"--declaration"})," option is passed, Packemon will generate TypeScript declarations for all\ninputs. This process would assume that a ",(0,r.jsx)(n.code,{children:"tsconfig.json"})," existed in the package root. This file\ncould then be overridden with the ",(0,r.jsx)(n.code,{children:"--declarationConfig"})," option."]}),"\n",(0,r.jsxs)(n.p,{children:["However, in TypeScript v4.7, the\n",(0,r.jsxs)(n.a,{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-4-7/#new-file-extensions",children:["new ",(0,r.jsx)(n.code,{children:".cts"})," and ",(0,r.jsx)(n.code,{children:".mts"})," file extensions were released"]}),".\nWith this release, the declaration outputs have also changed, and may produce ",(0,r.jsx)(n.em,{children:"different outputs"}),"\ndepending on the source file type (cjs vs esm). Because of this, we can no longer generate\ndeclarations ",(0,r.jsx)(n.em,{children:"for all formats using a single tsconfig"}),", especially when building multiple formats in\nparallel!"]}),"\n",(0,r.jsxs)(n.p,{children:["To solve this problem, Packemon now requires a ",(0,r.jsx)(n.code,{children:"tsconfig.<format>.json"})," file. For example, if you're\nbuilding the formats ",(0,r.jsx)(n.code,{children:"lib"})," and ",(0,r.jsx)(n.code,{children:"esm"}),", you'll now need ",(0,r.jsx)(n.code,{children:"tsconfig.lib.json"})," and ",(0,r.jsx)(n.code,{children:"tsconfig.esm.json"}),"\nfiles. This ",(0,r.jsx)(n.em,{children:"cannot"})," be changed, as as such, the ",(0,r.jsx)(n.code,{children:"--declarationConfig"})," option has been removed."]}),"\n",(0,r.jsx)(n.h2,{id:"typescript-declaration-output-directory-has-changed",children:"TypeScript declaration output directory has changed"}),"\n",(0,r.jsxs)(n.p,{children:["As a side-effect of the change above, the output directory of declarations have also changed.\nInstead of generating to a ",(0,r.jsx)(n.code,{children:"dts"})," folder, they will now generate to the format folders, ",(0,r.jsx)(n.code,{children:"lib"}),", ",(0,r.jsx)(n.code,{children:"esm"}),",\netc."]}),"\n",(0,r.jsxs)(n.p,{children:["If using project references, you'll need to manually update ",(0,r.jsx)(n.code,{children:"outDir"})," as we cannot pass the\n",(0,r.jsx)(n.code,{children:"--outDir"})," option for composite builds."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "extends": "../../tsconfig.options.json",\n  "compilerOptions": {\n    "outDir": "lib"\n  },\n  "include": ["src/**/*"]\n}\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"package-exports-have-changed",children:["Package ",(0,r.jsx)(n.code,{children:"exports"})," have changed"]}),"\n",(0,r.jsxs)(n.p,{children:["To support the TypeScript differences mentioned above, the ",(0,r.jsx)(n.code,{children:"package.json"})," ",(0,r.jsx)(n.code,{children:"exports"})," had to also\nchange. Instead of having a ",(0,r.jsx)(n.code,{children:"types"})," export at the top-level, it will now be nested within ",(0,r.jsx)(n.code,{children:"import"}),"\nor ",(0,r.jsx)(n.code,{children:"require"}),", depending on the format and combinations. This also means that ",(0,r.jsx)(n.code,{children:"import"})," and ",(0,r.jsx)(n.code,{children:"require"}),"\nmay have different type declarations if need be."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// Before\n".": {\n  "types": "./dts/index.d.ts",\n  "node": "./lib/index.js",\n  "default": "./lib/index.js"\n}\n\n// After\n".": {\n  "node": {\n    "types": "./lib/index.d.ts",\n    "default": "./lib/index.js"\n  },\n  "default": "./lib/index.js"\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"publishable-files-are-now-lenient",children:"Publishable files are now lenient"}),"\n",(0,r.jsxs)(n.p,{children:["When the ",(0,r.jsx)(n.code,{children:"--addFiles"})," option is passed, we update the ",(0,r.jsx)(n.code,{children:"files"})," field in the package's ",(0,r.jsx)(n.code,{children:"package.json"}),"\nwith a whitelist of files that should be published. Previously, this would use a glob with a strict\nmatch on file extension, for example ",(0,r.jsx)(n.code,{children:"src/**/*.{ts,tsx,json}"})," or ",(0,r.jsx)(n.code,{children:"cjs/**/*.{cjs,mjs,map}"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["With the amount of file extensions now available in the JavaScript ecosystem, this has become very\ntedious to determine accurately, and as such, these globs have dropped the file extension\nrequirement. For example, these are simply now ",(0,r.jsx)(n.code,{children:"src/**/*"})," and ",(0,r.jsx)(n.code,{children:"cjs/**/*"}),"."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Do note, we ",(0,r.jsx)(n.em,{children:"do not"})," remove the previous globs, so you'll need to manually fix each\n",(0,r.jsx)(n.code,{children:"package.json"}),"!"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"removed-sourcemaps-from-nodejs",children:"Removed sourcemaps from Node.js"}),"\n",(0,r.jsxs)(n.p,{children:["Packemon would always create sourcemaps, as it provides a mechanism for consumers to debug issues\nwith their code, specifically when it was bundled with Webpack or Metro. However, this wasn't really\nnecessary for Node.js packages, as they are typically developer tooling or scripts related, and ",(0,r.jsx)(n.em,{children:"are\nnot"})," bundled. Consumers can inspect ",(0,r.jsx)(n.code,{children:"node_modules"})," directly to debug these packages."]}),"\n",(0,r.jsx)(n.p,{children:"Because of this, we have removed sourcemaps entirely from Node.js based packages. This will grealy\nreduce the overall package size."}),"\n",(0,r.jsx)(n.h2,{id:"other-minor-changes",children:"Other minor changes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"pack"})," and ",(0,r.jsx)(n.code,{children:"pack-workspace"})," commands will automatically set ",(0,r.jsx)(n.code,{children:"NODE_ENV=production"})," now."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"type"})," field in ",(0,r.jsx)(n.code,{children:"package.json"})," will no longer be set."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"lib"})," format is ",(0,r.jsx)(n.em,{children:"no longer"})," automatically enabled when using the ",(0,r.jsx)(n.code,{children:"esm"})," format."]}),"\n",(0,r.jsx)(n.li,{children:"Removed most of the React/Ink integration for rendering to the terminal, as it was major\nbottleneck for performance."}),"\n",(0,r.jsxs)(n.li,{children:["Removed ",(0,r.jsx)(n.code,{children:"babelrcRoots"})," support from our internal Babel configuration."]}),"\n",(0,r.jsxs)(n.li,{children:["Removed the ",(0,r.jsx)(n.code,{children:"engines"})," version constraint feature."]}),"\n",(0,r.jsxs)(n.li,{children:["Removed the ",(0,r.jsx)(n.code,{children:"npm"})," engine when adding engines with ",(0,r.jsx)(n.code,{children:"--addEngines"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Removed the ",(0,r.jsx)(n.code,{children:"--files"})," option from ",(0,r.jsx)(n.code,{children:"packemon validate"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},3023:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var r=s(3696);const o={},i=r.createContext(o);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);