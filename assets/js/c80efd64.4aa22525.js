"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4999],{2722:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>d});var a=t(2540),s=t(3023),i=t(9479),r=t(2491);const l={title:"Advanced"},o=void 0,c={id:"advanced",title:"Advanced",description:"Creating binary files",source:"@site/docs/advanced.mdx",sourceDirName:".",slug:"/advanced",permalink:"/docs/advanced",draft:!1,unlisted:!1,editUrl:"https://github.com/milesj/packemon/edit/master/website/docs/advanced.mdx",tags:[],version:"current",frontMatter:{title:"Advanced"},sidebar:"docs",previous:{title:"watch",permalink:"/docs/watch"},next:{title:"4.0",permalink:"/docs/migrate/4.0"}},u={},d=[{value:"Creating binary files",id:"creating-binary-files",level:2},{value:"Customizing Babel, swc, and Rollup",id:"customizing-babel-swc-and-rollup",level:2},{value:"Stamping releases",id:"stamping-releases",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"creating-binary-files",children:"Creating binary files"}),"\n",(0,a.jsxs)(n.p,{children:["A binary is an executable file distributed in an npm package via the\n",(0,a.jsx)(n.a,{href:"https://docs.npmjs.com/files/package.json#bin",children:"bin"})," field. Packemon offers first class support for\nbinary files by:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Prepending a ",(0,a.jsx)(n.code,{children:"#!/usr/bin/env node"})," shebang to the output file. Do not include this in the source\nfile!"]}),"\n",(0,a.jsxs)(n.li,{children:["Updating the ",(0,a.jsx)(n.code,{children:"bin"})," field in ",(0,a.jsx)(n.code,{children:"package.json"})," to the output file (if not already defined)."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["To make use of this functionality, you must define an ",(0,a.jsx)(n.a,{href:"/docs/config#inputs",children:"input"})," with the name\n",(0,a.jsx)(n.code,{children:"bin"}),", or store your bins in a ",(0,a.jsx)(n.code,{children:"bin"})," directory."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "name": "package",\n  "packemon": {\n    "inputs": {\n      "bin": "src/bin.ts"\n    },\n    "platform": "node"\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The contents of the binary source file can be whatever you want, but do be aware that code in the\nmodule scope will be executed immediately when the file is executed by Node.js."}),"\n",(0,a.jsx)(n.h2,{id:"customizing-babel-swc-and-rollup",children:"Customizing Babel, swc, and Rollup"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"This is an advanced escape hatch and should be avoided unless absolutely necessary, for example,\nprocessing CSS files in a way that Packemon does not support."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Customizing the Babel, swc, and Rollup configs are an ",(0,a.jsx)(n.em,{children:"opt-in feature"}),", and require the following\nconditions to be met:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A ",(0,a.jsx)(n.code,{children:"--loadConfigs"})," option is passed on the command line. This enables searching and loading of\nconfig files, otherwise, we want to avoid the filesystem lookups."]}),"\n",(0,a.jsxs)(n.li,{children:["A ",(0,a.jsx)(n.code,{children:"packemon.config.{ts,js}"})," file at the monorepo/polyrepo root, which applies customizations to\nall packages. Or ",(0,a.jsx)(n.em,{children:"optional"})," ",(0,a.jsx)(n.code,{children:".packemon.{ts,js}"})," files within each package, which applies\ncustomizations to that package individually. An example of this is found below, or view the\n",(0,a.jsx)(n.a,{href:"https://boostlib.dev/docs/config",children:"@boost/config"})," docs."]}),"\n"]}),"\n",(0,a.jsxs)(i.A,{groupId:"package-structure",defaultValue:"poly",values:[{label:"Polyrepo",value:"poly"},{label:"Monorepo",value:"mono"}],children:[(0,a.jsx)(r.A,{value:"poly",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"/\n\u251c\u2500\u2500 src/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 packemon.config.js\n\u251c\u2500\u2500 LICENSE\n\u2514\u2500\u2500 README.md\n"})})}),(0,a.jsx)(r.A,{value:"mono",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"/\n\u251c\u2500\u2500 packages/\n\u2502   \u251c\u2500\u2500 foo/\n\u2502   |   \u251c\u2500\u2500 src/\n\u2502   |   \u251c\u2500\u2500 .packemon.js\n\u2502   |   \u251c\u2500\u2500 package.json\n\u2502   |   \u251c\u2500\u2500 LICENSE\n\u2502   |   \u2514\u2500\u2500 README.md\n\u2502   \u251c\u2500\u2500 bar/\n\u2502   |   \u251c\u2500\u2500 src/\n\u2502   |   \u251c\u2500\u2500 .packemon.js\n\u2502   |   \u251c\u2500\u2500 package.json\n\u2502   |   \u251c\u2500\u2500 LICENSE\n\u2502   |   \u2514\u2500\u2500 README.md\n\u2502   \u2514\u2500\u2500 baz/\n\u2502       \u251c\u2500\u2500 src/\n\u2502       \u251c\u2500\u2500 .packemon.js\n\u2502       \u251c\u2500\u2500 package.json\n\u2502       \u251c\u2500\u2500 LICENSE\n\u2502       \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 lerna.json\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 packemon.config.js\n\u251c\u2500\u2500 LICENSE\n\u2514\u2500\u2500 README.md\n"})})})]}),"\n",(0,a.jsxs)(n.p,{children:["Both of these config files have the same structure, and may define the fields below. All of these\nfields require a function (except ",(0,a.jsx)(n.code,{children:"swc"}),"), which is passed the finalized config as an argument (with\noutput fields also accepting the current build as the 2nd argument). This config can then be mutated\nin place."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"babelInput"})," - For parsing syntax into an AST (TypeScript, JSX, etc)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"babelOutput"})," - For applying transformations."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"rollupInput"})," - For defining inputs, outputs, and more."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"rollupOutput"})," - For customizing each output."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"swc"})," - Enables swc instead of Babel."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"swcInput"})," - For parsing syntax into an AST (TypeScript, JSX, etc)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"swcOutput"})," - For applying transformations."]}),"\n"]}),"\n",(0,a.jsxs)(i.A,{groupId:"configs",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],children:[(0,a.jsx)(r.A,{value:"ts",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:"import type { ConfigFile } from 'packemon';\nimport linaria from '@linaria/rollup';\n\nconst config: ConfigFile = {\n  babelOutput(config, build) {\n    config.presets.push('@linaria/babel-preset');\n  },\n  rollupInput(config) {\n    config.plugins.unshift(linaria());\n  },\n};\n\nexport default config;\n"})})}),(0,a.jsx)(r.A,{value:"js",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const linaria = require('@linaria/rollup');\n\nmodule.exports = {\n  babelOutput(config) {\n    config.presets.push('@linaria/babel-preset');\n  },\n  rollupInput(config) {\n    config.plugins.unshift(linaria());\n  },\n};\n"})})})]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["We suggest ",(0,a.jsx)(n.em,{children:"not mutating"})," the config that Packemon generates, as it may break our assumptions.\nInstead, prefer to only apply additions that add new functionality."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"stamping-releases",children:"Stamping releases"}),"\n",(0,a.jsxs)(n.p,{children:["For situations where you update Packemon and want to release ",(0,a.jsx)(n.em,{children:"every"})," package, even those that have\nnot been modified since the last release, you can use stamping. Stamping is a very simple concept\nwhere we modify the ",(0,a.jsx)(n.code,{children:"package.json"})," of each package with a ",(0,a.jsx)(n.code,{children:"release"})," timestamp, and can be achieved\nby passing ",(0,a.jsx)(n.code,{children:"--stamp"})," to the ",(0,a.jsx)(n.code,{children:"build"})," or ",(0,a.jsx)(n.code,{children:"pack"})," commands."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},2491:(e,n,t)=>{t.d(n,{A:()=>r});t(3696);var a=t(1750);const s={tabItem:"tabItem_wHwb"};var i=t(2540);function r(e){let{children:n,hidden:t,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,r),hidden:t,children:n})}},9479:(e,n,t)=>{t.d(n,{A:()=>h});var a=t(3696),s=t(1750),i=t(766),r=t(5373),l=t(6681);const o={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=t(2540);function u(e){let{className:n,block:t,selectedValue:a,selectValue:r,tabValues:l}=e;const u=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),p=e=>{const n=e.currentTarget,t=u.indexOf(n),s=l[t].value;s!==a&&(d(n),r(s))},h=e=>{var n;let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{var a;const n=u.indexOf(e.currentTarget)+1;t=null!=(a=u[n])?a:u[0];break}case"ArrowLeft":{var s;const n=u.indexOf(e.currentTarget)-1;t=null!=(s=u[n])?s:u[u.length-1];break}}null==(n=t)||n.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,c.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>u.push(e),onKeyDown:h,onClick:p,...i,className:(0,s.A)("tabs__item",o.tabItem,null==i?void 0:i.className,{"tabs__item--active":a===n}),children:null!=t?t:n},n)}))})}function d(e){let{lazy:n,children:t,selectedValue:s}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===s));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function p(e){const n=(0,r.u)(e);return(0,c.jsxs)("div",{className:(0,s.A)("tabs-container",o.tabList),children:[(0,c.jsx)(u,{...n,...e}),(0,c.jsx)(d,{...n,...e})]})}function h(e){const n=(0,l.A)();return(0,c.jsx)(p,{...e,children:(0,r.v)(e.children)},String(n))}},5373:(e,n,t)=>{t.d(n,{u:()=>h,v:()=>c});var a=t(3696),s=t(9519),i=t(4395),r=t(5043),l=t(4544),o=t(8708);function c(e){var n,t;return null!=(n=null==(t=a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}function u(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:function(e){return c(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:s}}=e;return{value:n,label:t,attributes:a,default:s}}))}(t);return function(e){const n=(0,l.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function d(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:t}=e;const i=(0,s.W6)(),l=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,r.aZ)(l),(0,a.useCallback)((e=>{if(!l)return;const n=new URLSearchParams(i.location.search);n.set(l,e),i.replace({...i.location,search:n.toString()})}),[l,i])]}function h(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,r=u(e),[l,c]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const s=null!=(n=a.find((e=>e.default)))?n:a[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[h,f]=p({queryString:t,groupId:s}),[m,b]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[s,i]=(0,o.Dv)(t);return[s,(0,a.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:s}),g=(()=>{const e=null!=h?h:m;return d({value:e,tabValues:r})?e:null})();(0,i.A)((()=>{g&&c(g)}),[g]);return{selectedValue:l,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:r}))throw new Error("Can't select invalid tab value="+e);c(e),f(e),b(e)}),[f,b,r]),tabValues:r}}},3023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var a=t(3696);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);